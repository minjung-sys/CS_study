# 프로세스와 스레드 

## 프로세스란?
프로세스(Process)는 컴퓨터에서 실행되고 있는 프로그램을 말하며, CPU 스케줄링의 대상이 되는 작업이라는 용어와 같은의미, 스레드는 프로세스 내 작업의 흐름을 지칭 

## 프로세스와 컴파일 과정

**프로세스 : 프로그램으로부터 인스턴스화된 것**
**프로그램 : 컴파일러가 컴파일 과정을 거쳐 컴퓨터가 이해할 수 있는 기계어로 번역되어 실행하는 파일**

`전처리`

소스코드의 주석을 제거하고 #include 등 헤더 파일을 병합하여 메크로를 치환

`컴파일러`

오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환

`어셈블러`

어셈블리어는 목적 코드로 변환

`링커`

프로그램 내에 있는 라이브러라 함수 또는 다른 파일들과 목적코드를 결합하여 실행파일을 만듬. 실행 파일의 확장자는 .exe또는 .out 확장자


정적 라이브러리와 동적 라이브러리

> 정적 라이브러리 : 프로그램 빌드 시 라이브러리가 제공하는 모든 코드를 실행 파일에 넣는 방식이며, 시스템 환경 등 외부 의존도가 낮고 코드 중복 등 메모리 효율성이 떨어짐

동적 라이브러리 : 프로그램 실행 시 필요할 때만 DLL 이라는 함수 정보를 통해 참조하는 방식이며, 메모리 효율성에서의 장점과 외부 의존도가 높아진다는 단점 존재
> 

## 프로세스의 상태

*프로세스의 상태를 여러가지 상태값을 가진다*

**생성상태**
→ `생성 상태는 프로세스가 생성된 상태, fork() 또는 exec() 함수를 통해 생성`

- fork()
→ 부모 프로세스의 주소 공간을 그대로 복사하며, 새로운 자식 프로세스를 생성하는 함수 (부모 프로세스의 비동기 작업 등을 상속하지는 않음 !
- exec()
→exec() 은 새롭게 프로세스를 생성하는 함수

### 대기 상태

메모리 공간이 충분하면 메모리를 할당받고, 아니면 아닌 상태로 대기
CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태

### 대기 중단 상태

메모리 부족으로 일시 중단된 상태

### 실행상태

CPU 소유권과 메모리를 할당받고 인스트럭션을 수행중인 상태를 의미, CPU burst 가 일어났다고도 표현함

### 중단 상태

어떤 이벤트가 발생한 이후 기다리며 프로세스가 차단된 상태

### 일시 중단 상태

대기 중단과 유사! 중단된 상태에서 프로세스가 실행되려고 했지만 메모리 부족으로 일시 중단된 상태

### 종료 상태

메모리와 CPU 소유권을 모두 놓고 가는 상태를 말한다. 자연스럽게 종료시키는 것과 강제 비 자발적 종료 존재
→ 할당된 자원의 한계치를 넘어서가나 부모 프로세스가 종료되어 process, kill 등 명령어로 프로세스 종료

## 프로세스의 메모리 구조

: 스택, 힙, 데이터 영역, 코드 영역으로 나뉘어짐. 스택은 위 주소부터 할당되고 힙은 아래 주소부터 할당

### 스택

지역변수, 매개변수, 함수가 저장되고 컴파일 시에 크기가 결정되며 ‘동적’인 특징을 갖는다

스택 영역은 함수가 함수를 재귀적으로 호출하면서 동적으로 크기가 늘어날 수 있는데 이때 힙과 스택 사이 공간을 비워놓는다

### 힙

동적할당 시 사용되며 런타임 크기가 결정, ‘동적’인 특징을 가진다

### 데이터 영역

전역변수, 정적변수가 저장되고, 정적인 특징을 갖는 프로그램이 종료되면 사라지는 변수가 들어 있는 영역

### 코드 영역

프로그램에 내자오디어 있는 소스 코드가 들어가는 영역 , 수정 불가능한 기계어로 저장되어 있으며 정적인 특징이 있음

### PCB

운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터, 프로세스 제어 블록이라고도 함
프로세스가 생성되면 운영체제는 해당 PCB를 생성함

프로그램 실행 → 프로세스 생성 → 프로세스의 메타데이터들이 PCB에 저장되어 관리 

- 일반 사용자가 접근하지 못하도록 커널 스택의 가장 앞부분에서 관리됌!

### PCB 의 구조

- 프로세스 스케줄링 상태 → 프로세스가 CPU에 대한 소유권을 얻은 이후의 상태
- 프로세스 ID → 프로세스 ID, 해당 프로세스의 자식 프로세스 ID
- 프로세스 권한 → 컴퓨터 자원 또는 I/O 디바이스에 대한 권한 정보
- 프로그램 카운터 → 프로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터
- CPU 레지스터 →  프로세스에서 실행하기 위해 저장해햐 할 레지스터에 대한 정보
- CPU 스케줄링 정보 → CPU 스케줄러에 의해 중단된 시간 등에 대한 정보
- 계정 정보 → 프로세스 실행에 사용된 CPU 사용량, 유저 정보
- I/O 상태 정보  → 프로세스에 할당된 I/O 디바이스 목록

### *컨텍스트* 스위칭

PCB를 교환하는 과정 , 한 프로세스에 할당된 시간이 끝나거나 인터럽트에 의해 발생
예시) 한개의 프로세스 A가 실행하다 멈추고, 프로세스 A의 PCB를 저장하고 다시 프로세스 B를 로드하여 실행

컨텍스트 스위칭이 일어날 때 유휴 시간이 발생하는데, 이 떄 발생하는 비용이 캐시미스

**비용: 캐시미스**

컨텍스트 스위칭이 일어날 때 프로세스가 가지고 있는 메모리 주소가 그대로 있으면 잘못된 주소 변환이 생기므로 캐시 클리어 과정을 겪게 되고 이 때문에 캐시미스가 발생 

**스레드에서의 컨텍스트 스위칭**

스택 영역을 제외한 모든 메모리를 공유하기 때문에 스레드 컨텍스트 스위칭의 경우 비용이 더 적고 시간도 더 적게 걸림


## 멀티 프로세싱

여러개의 프로세스, 즉 멀티프로세스를 통해 동시에 두가지 이상의 일을 수행할 수 있는 것 

하나이상의 일을 병렬로 처리할 수 있으며 특정 프로세스의 메모리, 프로세스 중 일부의 문제가 발생되더라도 다른 프로세스를 이용할 수 있으므로 신뢰성이 높다

### 웹 브라우저

- 브라우저 프로세스 : 주소 표시줄, 북마크 막대, 뒤로가기 버튼, 앞으로가기 버튼 등 담당,네트워크 요청, 파일 접근권한 담당
- 렌더러 프로세스 : 눈에 보이는 모든 것을 제어
- 플러그인 프로세스 : 웹사이트에서 사용하는 플러그인 제어
- GPU 프로세스 : GPU를 이용해서 화면을 그리는 부분 제어

### IPC

멀티프로세스는 IPC가 가능하며 이는 프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 메커니즘을 뜻함
→ 클라이언트는 데이터 요청, 서버는 클러이언트에 요청

**공유 메모리**

여러 프로세스에 동일한 메모리 블록에 대한 접근 권한이 부여되어 프로세스가 서로 통신할 수 있도록 공유 버퍼를 생성하는 것

**파일**

디스크에 저장된 데이터 또는 파일 서버에서 제공한 데이터

**소켓**

동일한 컴퓨터의 다른 프로세스나 네트워크의 다른 컴퓨터로 네트워크 인터페이스를 통해 전송하는 데이터를 의미

**익명 파이프**

프로세스 간에 FIFO 방식으로 읽히는 임시 공간인 파이프를 기반으로 데이터를 주고 받으며, 단방향 방식의 읽기 전용, 쓰기 전용 파이프를 만들어 작동하는 방식

**명명된 파이프**

파이프 서버와 하나 이상의 파이프 클라이언트 간의 토인을 위한 명명된 단방향 또는 이중 파이프
클라이언트/서버 통신을 위한 별도의 파이프를 제공하며, 여러 파이프를 동시에 사용할 수 있음

**메시지 큐**

메시지를 큐 데이터 구조 형태로 관리하는 것을 의미, 커널에서 관리되며 다른 IPC 방식에 비해서 사용 방법이 매우 직관적이고 간단하며 다른 코드의 수정 없이 코드를 추가시켜 간단하게 메시지 큐에 접근할 수 있음 

공유 메모리를 통해 IPC를 구현할 때 쓰기 및 일기 빈도가 높으면 동기화 때문에 기능을 구현하는 것이 복잡해지는데, 이때 대안으로 메시지 큐를 사용하기도 함